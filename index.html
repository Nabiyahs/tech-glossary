


<div class="tech-glossary">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
        .tech-glossary {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
            line-height: 1.6;
        }

        .tech-glossary * {
            box-sizing: border-box;
        }

        .tech-glossary .glossary-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #0047AB;
            padding-bottom: 20px;
        }

        .tech-glossary .glossary-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #0047AB;
            margin-bottom: 10px;
            margin-top: 0;
        }

        .tech-glossary .glossary-subtitle {
            font-size: 1.5rem;
            color: #666;
            font-weight: 500;
            margin: 0;
        }

        .tech-glossary .disclaimer-box {
            background: #f8f9fa;
            border-left: 4px solid #0047AB;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .tech-glossary .disclaimer-box p {
            margin: 0 0 10px 0;
        }

        .tech-glossary .disclaimer-box p:last-child {
            margin-bottom: 0;
        }

    .tech-glossary {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px; margin: 0 auto; padding: 20px; background: #fff; line-height: 1.6;
    }
    .tech-glossary * { box-sizing: border-box; }
    .glossary-header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #0047AB; padding-bottom: 20px; }
    .glossary-title { font-size: 2rem; font-weight: 800; color: #0047AB; margin: 0 0 6px 0; }
    .glossary-subtitle { font-size: 1.1rem; color: #666; font-weight: 600; margin: 0; }

    .disclaimer-box { background: #f8f9fa; border-left: 4px solid #0047AB; padding: 16px; margin-bottom: 20px; border-radius: 6px; }
    .disclaimer-box p { margin: 0; }

    .search-add-section { display: flex; gap: 12px; align-items: center; margin-bottom: 14px; }
    .search-input { flex: 1; padding: 12px 16px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
    .search-input:focus { border-color: #0047AB; outline: none; box-shadow: 0 0 0 3px rgba(0,71,171,.1); }

    .controls-section { display: flex; gap: 12px; align-items: center; margin-bottom: 12px; flex-wrap: wrap; }
    .view-controls { display: flex; gap: 8px; }
    .view-btn { display: flex; align-items: center; gap: 6px; padding: 8px 12px; border: 2px solid #ddd; background: #fff; color: #333; border-radius: 8px; cursor: pointer; transition: all .2s; font-size: 14px; font-weight: 600; }
    .view-btn:hover { border-color: #0047AB; color: #0047AB; }
    .view-btn.active { background: #0047AB; color: #fff; border-color: #0047AB; }

    .disciplines-section { margin-bottom: 16px; display: flex; flex-wrap: wrap; gap: 8px; }
    .discipline-tag { padding: 7px 12px; background: #e9ecef; border: 1px solid #ddd; border-radius: 18px; cursor: pointer; transition: all .2s; font-size: 13px; display: flex; align-items: center; gap: 6px; }
    .discipline-tag:hover { background: #dee2e6; }
    .discipline-tag.active { background: #0047AB; color: #fff; border-color: #0047AB; }
    .discipline-tag i { font-size: 14px; }

    .glossary-table-container { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,.08); }
    .glossary-table { width: 100%; border-collapse: collapse; margin: 0; table-layout: fixed; }
    .glossary-table th { background: #f8f9fa; padding: 12px 8px; text-align: left; font-weight: 700; border-bottom: 2px solid #ddd; color: #333; position: sticky; top: 0; z-index: 1; }
    .glossary-table td { padding: 10px 8px; border-bottom: 1px solid #eee; vertical-align: top; word-break: break-word; }
    .glossary-table tr:hover { background: #f8f9fa; }
    .glossary-table tr:last-child td { border-bottom: none; }

    .discipline-badge { background: rgba(0,71,171,.1); color: #0047AB; padding: 3px 6px; border-radius: 4px; font-size: 12px; font-weight: 700; display: inline-block; }
    .term-en { font-weight: 700; color: #333; }
    .term-kr { font-weight: 700; color: #0047AB; }
    .empty-state { text-align: center; padding: 30px; color: #666; font-style: italic; }

    .sort-controls { display: flex; gap: 8px; margin-left: auto; }
    .category-col { font-size: 12px; color: #495057; }
    .category-cell { display: inline-flex; align-items: center; gap: 4px; background: #f0f4f8; padding: 4px 8px; border-radius: 4px; font-weight: 600; white-space: nowrap; }
    .category-cell i { color: #0047AB; font-size: 11px; }

    .pagination-container { margin-top: 12px; padding: 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center; gap: 14px; }
    .pagination-info { font-size: 13px; color: #6c757d; font-weight: 600; }
    .pagination-controls { display: flex; align-items: center; gap: 6px; }
    .pagination-btn { padding: 6px 10px; border: 1px solid #ddd; background: #fff; color: #495057; cursor: pointer; border-radius: 4px; font-size: 13px; font-weight: 600; transition: all .2s; min-width: 36px; height: 32px; display: flex; align-items: center; justify-content: center; }
    .pagination-btn:hover:not(:disabled) { background: #0047AB; color: #fff; border-color: #0047AB; }
    .pagination-btn:disabled { background: #f8f9fa; color: #adb5bd; cursor: not-allowed; border-color: #dee2e6; }
    .pagination-btn.active { background: #0047AB; color: #fff; border-color: #0047AB; }
    .pagination-pages { display: flex; gap: 4px; }
    .pagination-ellipsis { padding: 6px 4px; color: #6c757d; font-size: 13px; display: flex; align-items: center; }

    @media (max-width: 768px) {
      .tech-glossary { padding: 10px; }
      .glossary-title { font-size: 1.6rem; }
      .glossary-table th, .glossary-table td { padding: 8px 6px; font-size: 14px; }
      .glossary-table th:nth-child(5), .glossary-table td:nth-child(5) { display: none; }
      .pagination-container { flex-direction: column; gap: 10px; text-align: center; }
      .pagination-controls { justify-content: center; flex-wrap: wrap; }
    }
  </style>

  <!-- Header -->
  <div class="glossary-header" role="region" aria-label="Technical Glossary Header">
    <h1 class="glossary-title">English-Korean Technical Glossary</h1>
    <div class="glossary-subtitle">í•œì˜ ê¸°ìˆ ìš©ì–´ì§‘</div>
  </div>

  <!-- Disclaimer -->
  <div class="disclaimer-box">
    <p><strong>ğŸ“‹ ì•ˆë‚´ì‚¬í•­:</strong> ì´ ìš©ì–´ì§‘ì€ SAMOO í•˜ì´í…Œí¬ 1ë³¸ë¶€ì—ì„œ í•´ì™¸ ì„¤ê³„ì‚¬ ë° ê±´ì„¤ì‚¬ì™€ì˜ í”„ë¡œì íŠ¸ íšŒì˜ í†µì—­ ë° ë²ˆì—­ ì—…ë¬´ë¥¼ í†µí•´ ì¶•ì ëœ ì‹¤ë¬´ ìš©ì–´ì§‘ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê° ìš©ì–´ëŠ” ê´€ë ¨ì„±ê³¼ ì‹¤ë¬´ í™œìš©ë„ì— ë”°ë¼ í•´ë‹¹ ê³µì¢…ìœ¼ë¡œ ë¶„ë¥˜í•˜ì˜€ìœ¼ë©°, ì—¬ëŸ¬ ê³µì¢…ì— ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ìš©ì–´ì˜ ê²½ìš° ì£¼ìš” ì ìš© ë¶„ì•¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°°ì¹˜í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
    <p><strong>ğŸ“§ ë¬¸ì˜:</strong> í•˜ì´í…Œí¬ 1ë³¸ë¶€ ì¡°í¬ìˆ˜ í”„ë¡œ</p>
  </div>

  <!-- Search -->
  <div class="search-add-section" role="search">
    <input type="text" id="searchInput" class="search-input" placeholder="ìš©ì–´ ê²€ìƒ‰ (ì˜ì–´, í•œêµ­ì–´, ì„¤ëª…)..." aria-label="ìš©ì–´ ê²€ìƒ‰ ì…ë ¥">
  </div>

  <!-- Controls -->
  <div class="controls-section" aria-label="ë³´ê¸° ì „í™˜">
    <div class="view-controls" role="group" aria-label="ë³´ê¸° ì„ íƒ">
      <button class="view-btn active" id="disciplineViewBtn" type="button">
        <i class="fa-solid fa-layer-group"></i>
        ê³µì¢…ë³„ ë³´ê¸°
      </button>
      <button class="view-btn" id="allViewBtn" type="button">
        <i class="fa-solid fa-list"></i>
        ì „ì²´ ë³´ê¸°
      </button>
    </div>
    <div class="sort-controls" role="group" aria-label="ì •ë ¬ ë°©ì‹">
      <button class="view-btn" id="alphabetSortBtn" type="button">
        <i class="fa-solid fa-arrow-down-a-z"></i>
        ì•ŒíŒŒë²³ìˆœ
      </button>
      <button class="view-btn active" id="relevanceSortBtn" type="button">
        <i class="fa-solid fa-sitemap"></i>
        ì—°ê´€ì„±ìˆœ
      </button>
    </div>
  </div>

  <!-- Discipline Shortcuts -->
  <div class="disciplines-section" id="disciplineShortcuts" role="navigation" aria-label="ê³µì¢… ì„ íƒ"></div>

  <!-- Table -->
  <div class="glossary-table-container" role="region" aria-label="ìš©ì–´ í…Œì´ë¸”">
    <table class="glossary-table" id="glossaryTable">
      <thead>
      <tr>
        <th id="disciplineHeader" style="width:8%;display:none">êµ¬ë¶„</th>
        <th id="categoryHeader" style="width:12%">Category</th>
        <th style="width:28%">EN</th>
        <th style="width:22%">KR</th>
        <th style="width:30%">ì„¤ëª…</th>
      </tr>
      </thead>
      <tbody id="glossaryTableBody"></tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" id="paginationContainer" style="display:none" aria-label="í˜ì´ì§€ë„¤ì´ì…˜">
    <div class="pagination-info"><span id="paginationInfo">ì „ì²´ 0ê°œ ìš©ì–´</span></div>
    <div class="pagination-controls">
      <button class="pagination-btn" id="firstPageBtn" title="ì²« í˜ì´ì§€" type="button">Â«</button>
      <button class="pagination-btn" id="prevPageBtn" title="ì´ì „ í˜ì´ì§€" type="button">â€¹</button>
      <div class="pagination-pages" id="paginationPages"></div>
      <button class="pagination-btn" id="nextPageBtn" title="ë‹¤ìŒ í˜ì´ì§€" type="button">â€º</button>
      <button class="pagination-btn" id="lastPageBtn" title="ë§ˆì§€ë§‰ í˜ì´ì§€" type="button">Â»</button>
    </div>
  </div>
</div>

<script>
/* ===========================================
   0) í—¬í¼ í•¨ìˆ˜ - í¼ì§€ ê²€ìƒ‰ ë° ëŒ€ë¬¸ì ì²˜ë¦¬
   =========================================== */

// Levenshtein ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (ì˜¤íƒ€ í—ˆìš© ê²€ìƒ‰ìš©)
function levenshteinDistance(str1, str2) {
  const m = str1.length;
  const n = str2.length;
  const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

  for (let i = 0; i <= m; i++) dp[i][0] = i;
  for (let j = 0; j <= n; j++) dp[0][j] = j;

  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      if (str1[i - 1] === str2[j - 1]) {
        dp[i][j] = dp[i - 1][j - 1];
      } else {
        dp[i][j] = Math.min(dp[i - 1][j - 1], dp[i - 1][j], dp[i][j - 1]) + 1;
      }
    }
  }
  return dp[m][n];
}

// í¼ì§€ ë§¤ì¹­ í•¨ìˆ˜ - ê²€ìƒ‰ì–´ì™€ í…ìŠ¤íŠ¸ê°€ ìœ ì‚¬í•œì§€ í™•ì¸
function fuzzyMatch(searchTerm, text) {
  if (!searchTerm || !text) return false;
  const search = searchTerm.toLowerCase();
  const target = text.toLowerCase();

  // ì •í™•íˆ í¬í•¨í•˜ë©´ true
  if (target.includes(search)) return true;

  // ë‹¨ì–´ë³„ë¡œ ë¶„ë¦¬í•˜ì—¬ ê²€ìƒ‰
  const words = target.split(/[\s,\/\-\(\)]+/).filter(w => w.length > 0);

  for (const word of words) {
    // ê²€ìƒ‰ì–´ê°€ 2ê¸€ì ì´í•˜ë©´ ê±°ë¦¬ 1ê¹Œì§€ í—ˆìš©
    // ê²€ìƒ‰ì–´ê°€ 3-4ê¸€ìë©´ ê±°ë¦¬ 1ê¹Œì§€ í—ˆìš©
    // ê²€ìƒ‰ì–´ê°€ 5ê¸€ì ì´ìƒì´ë©´ ê±°ë¦¬ 2ê¹Œì§€ í—ˆìš©
    const maxDistance = search.length <= 4 ? 1 : 2;

    // ë‹¨ì–´ ê¸¸ì´ê°€ ë¹„ìŠ·í•  ë•Œë§Œ í¼ì§€ ê²€ìƒ‰ ì ìš© (ê¸¸ì´ ì°¨ì´ê°€ í¬ë©´ ìŠ¤í‚µ)
    if (Math.abs(word.length - search.length) <= maxDistance) {
      const distance = levenshteinDistance(search, word);
      if (distance <= maxDistance) return true;
    }

    // ë¶€ë¶„ ë¬¸ìì—´ í¼ì§€ ê²€ìƒ‰ (ê¸´ ë‹¨ì–´ ë‚´ì—ì„œ)
    if (word.length >= search.length) {
      for (let i = 0; i <= word.length - search.length; i++) {
        const substr = word.substring(i, i + search.length);
        const distance = levenshteinDistance(search, substr);
        if (distance <= 1) return true;
      }
    }
  }

  return false;
}

// ì˜ì–´ ëŒ€ë¬¸ì ì²˜ë¦¬ í•¨ìˆ˜ - ì²« ê¸€ì ë° (, /, - ë‹¤ìŒ ê¸€ì ëŒ€ë¬¸ì
function formatEnglishTerm(text) {
  if (!text) return '';

  let result = '';
  let capitalizeNext = true;

  for (let i = 0; i < text.length; i++) {
    const char = text[i];

    if (capitalizeNext && /[a-zA-Z]/.test(char)) {
      result += char.toUpperCase();
      capitalizeNext = false;
    } else {
      result += char;
    }

    // (, /, - ë‹¤ìŒ ê¸€ìëŠ” ëŒ€ë¬¸ìë¡œ
    if (char === '(' || char === '/' || char === '-') {
      capitalizeNext = true;
    }
  }

  return result;
}

/* ===========================================
   1) ì™¸ë¶€ JSON ë°ì´í„° ë¡œë“œ
   =========================================== */
let glossaryData = [];

// Confluence ì²¨ë¶€íŒŒì¼ ê²½ë¡œ (í˜ì´ì§€ì— JSON íŒŒì¼ì„ ì²¨ë¶€í•œ í›„ ì‚¬ìš©)
// í˜ì´ì§€IDë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš” (ì˜ˆ: 123456789)
const PAGE_ID = 'YOUR_PAGE_ID';
const JSON_BASE_PATH = '/download/attachments/' + PAGE_ID;

const jsonFiles = {
  'General': 'general.json',
  'Architecture': 'architecture.json',
  'Civil': ['civil-1.json', 'civil-2.json', 'civil-3.json', 'civil-4.json'],
  'Structure': 'structure.json',
  'Fire Protection': 'fire-protection.json',
  'Piping': 'piping.json',
  'Electrical': 'electrical.json',
  'Instrument & Control': 'instrument-and-control.json',
  'HVAC': 'hvac.json',
  'BIM': 'bim.json',
  'Cell': 'cell.json'
};

async function loadGlossaryData() {
  const allData = [];
  const loadPromises = [];

  for (const [discipline, files] of Object.entries(jsonFiles)) {
    const fileList = Array.isArray(files) ? files : [files];
    for (const filename of fileList) {
      loadPromises.push(
        fetch(JSON_BASE_PATH + '/' + filename)
          .then(response => {
            if (!response.ok) throw new Error('Failed to load ' + filename);
            return response.json();
          })
          .catch(error => {
            console.warn('Failed to load ' + discipline + ' (' + filename + '):', error.message);
            return [];
          })
      );
    }
  }

  const results = await Promise.all(loadPromises);
  results.forEach(data => allData.push(...data));
  return allData;
}

const disciplineMap = {
  'General': { abbreviation: 'Gen', koreanName: 'ì¼ë°˜', icon: 'fa-solid fa-file-lines' },
  'Architecture': { abbreviation: 'Arch', koreanName: 'ê±´ì¶•', icon: 'fa-solid fa-building' },
  'Electrical': { abbreviation: 'Elec', koreanName: 'ì „ê¸°', icon: 'fa-solid fa-bolt' },
  'Piping': { abbreviation: 'Piping', koreanName: 'ë°°ê´€', icon: 'fa-solid fa-wrench' },
  'Civil': { abbreviation: 'Civil', koreanName: 'í† ëª©', icon: 'fa-solid fa-mountain' },
  'Instrument & Control': { abbreviation: 'I&C', koreanName: 'ì œì–´', icon: 'fa-solid fa-microchip' },
  'Fire Protection': { abbreviation: 'FP', koreanName: 'ì†Œë°©', icon: 'fa-solid fa-fire-extinguisher' },
  'HVAC': { abbreviation: 'HVAC', koreanName: 'ê³µì¡°', icon: 'fa-solid fa-fan' },
  'Structure': { abbreviation: 'Struct', koreanName: 'êµ¬ì¡°', icon: 'fa-solid fa-border-all' },
  'Cell': { abbreviation: 'Cell', koreanName: 'ë°°í„°ë¦¬', icon: 'fa-solid fa-car-battery' },
  'BIM': { abbreviation: 'BIM', koreanName: 'BIM', icon: 'fa-solid fa-cubes' }
};
const disciplineOrder = ['General','Architecture','Civil','Structure','Fire Protection','Piping','Electrical','Instrument & Control','HVAC','BIM','Cell'];

/* ===========================================
   2-1) ì—°ê´€ì„± ì¹´í…Œê³ ë¦¬ ë§¤í•‘
   =========================================== */
const categoryMap = {
  'Architecture': {
    'ë„ë©´/ë¬¸ì„œ': {
      icon: 'fa-solid fa-drafting-compass',
      order: 1,
      keywords: ['drawing', 'plan', 'section', 'elevation', 'detail', 'view', 'diagram', 'layout', 'scale', 'perspective', 'isometric', 'document', 'sheet', 'index', 'schedule']
    },
    'ë¬¸/ì¶œì…êµ¬': {
      icon: 'fa-solid fa-door-open',
      order: 2,
      keywords: ['door', 'gate', 'turnstile', 'entrance', 'doorway', 'opening', 'leaf', 'frame', 'handle', 'knob', 'latch', 'swing', 'hinged', 'sliding', 'revolving', 'overhead', 'folding']
    },
    'ê³„ë‹¨/ë™ì„ ': {
      icon: 'fa-solid fa-stairs',
      order: 3,
      keywords: ['stair', 'step', 'riser', 'tread', 'landing', 'ramp', 'circulation', 'corridor', 'aisle', 'walkway', 'passage', 'path', 'route', 'handrail', 'guard', 'railing']
    },
    'í”¼ë‚œ/ì•ˆì „': {
      icon: 'fa-solid fa-person-running',
      order: 4,
      keywords: ['egress', 'exit', 'refuge', 'evacuation', 'emergency', 'alarm', 'fire', 'smoke', 'sprinkler', 'extinguish', 'detection', 'standpipe', 'hazard', 'protection', 'safety', 'combustible', 'flammable']
    },
    'ë©´ì /ì¹˜ìˆ˜': {
      icon: 'fa-solid fa-ruler-combined',
      order: 5,
      keywords: ['area', 'height', 'width', 'depth', 'distance', 'clearance', 'footage', 'volume', 'capacity', 'load', 'occupant', 'size', 'measurement', 'dimension', 'stories', 'grade']
    },
    'ê³µê°„/ì‹¤': {
      icon: 'fa-solid fa-cube',
      order: 6,
      keywords: ['room', 'space', 'zone', 'basement', 'attic', 'mezzanine', 'lobby', 'vestibule', 'closet', 'shaft', 'enclosure', 'compartment', 'penthouse', 'platform']
    },
    'ë²½/ë°”ë‹¥/ì²œì¥': {
      icon: 'fa-solid fa-layer-group',
      order: 7,
      keywords: ['wall', 'partition', 'floor', 'ceiling', 'roof', 'panel', 'drywall', 'gypsum', 'tile', 'covering', 'finish', 'membrane', 'insulation', 'baseboard', 'siding']
    },
    'ì°½/ìœ ë¦¬': {
      icon: 'fa-solid fa-window-maximize',
      order: 8,
      keywords: ['window', 'glass', 'glazing', 'skylight', 'transom', 'louver', 'tempered', 'laminated', 'vision']
    },
    'ë²•ê·œ/ì¸í—ˆê°€': {
      icon: 'fa-solid fa-gavel',
      order: 9,
      keywords: ['code', 'approval', 'permit', 'certificate', 'occupancy', 'zoning', 'classification', 'requirement', 'compliance', 'rating', 'allowable', 'exception', 'regulation']
    },
    'ì§€ë¶•': {
      icon: 'fa-solid fa-house-chimney',
      order: 10,
      keywords: ['roof', 'eave', 'ridge', 'gable', 'hip', 'mansard', 'gambrel', 'dormer', 'pitch', 'parapet', 'flashing', 'curb']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'General': {
    'í”„ë¡œì íŠ¸/ê³„ì•½': {
      icon: 'fa-solid fa-file-contract',
      order: 1,
      keywords: ['project', 'contract', 'client', 'contractor', 'subcontract', 'delivery', 'rfp', 'rfq', 'rfi', 'bid', 'award', 'procurement']
    },
    'ì„¤ê³„': {
      icon: 'fa-solid fa-compass-drafting',
      order: 2,
      keywords: ['design', 'engineering', 'drawing', 'plan', 'detail', 'specification', 'parameter']
    },
    'ì‹œê³µ/ê³µì‚¬': {
      icon: 'fa-solid fa-helmet-safety',
      order: 3,
      keywords: ['construction', 'install', 'work', 'fastener', 'mounting', 'assembly']
    },
    'í’ˆì§ˆ/ì•ˆì „': {
      icon: 'fa-solid fa-shield-check',
      order: 4,
      keywords: ['quality', 'safety', 'test', 'inspection', 'resistance', 'protection']
    },
    'ì¬ë£Œ': {
      icon: 'fa-solid fa-cubes',
      order: 5,
      keywords: ['steel', 'metal', 'iron', 'paint', 'coat', 'rubber', 'resin', 'material', 'zinc', 'galvaniz']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'Civil': {
    'ë„ë¡œ/í¬ì¥': {
      icon: 'fa-solid fa-road',
      order: 1,
      keywords: ['road', 'pave', 'asphalt', 'concrete', 'curb', 'gutter', 'sidewalk', 'lane', 'traffic']
    },
    'ë°°ìˆ˜/ìš°ìˆ˜': {
      icon: 'fa-solid fa-droplet',
      order: 2,
      keywords: ['drain', 'storm', 'water', 'sewer', 'pipe', 'culvert', 'catch', 'basin', 'manhole']
    },
    'í† ê³µ/ê¸°ì´ˆ': {
      icon: 'fa-solid fa-mountain-sun',
      order: 3,
      keywords: ['earth', 'excavat', 'fill', 'grade', 'slope', 'soil', 'compact', 'foundation', 'retaining']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'Structure': {
    'ê¸°ë‘¥/ë³´': {
      icon: 'fa-solid fa-table-columns',
      order: 1,
      keywords: ['column', 'beam', 'girder', 'member', 'frame']
    },
    'ë°”ë‹¥/ìŠ¬ë˜ë¸Œ': {
      icon: 'fa-solid fa-square',
      order: 2,
      keywords: ['slab', 'floor', 'deck', 'topping']
    },
    'ì² ê·¼/ì½˜í¬ë¦¬íŠ¸': {
      icon: 'fa-solid fa-cubes-stacked',
      order: 3,
      keywords: ['concrete', 'rebar', 'reinforc', 'steel', 'bar', 'stirrup', 'anchor']
    },
    'ì ‘í•©': {
      icon: 'fa-solid fa-link',
      order: 4,
      keywords: ['connect', 'joint', 'weld', 'bolt', 'splice', 'embed']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'Electrical': {
    'ë°°ì„ /ì¼€ì´ë¸”': {
      icon: 'fa-solid fa-plug',
      order: 1,
      keywords: ['cable', 'wire', 'conduit', 'tray', 'raceway', 'duct', 'conductor']
    },
    'ë°°ì „ë°˜/ë¶„ì „ë°˜': {
      icon: 'fa-solid fa-server',
      order: 2,
      keywords: ['panel', 'board', 'switch', 'breaker', 'bus', 'mcc', 'distribution']
    },
    'ì¡°ëª…': {
      icon: 'fa-solid fa-lightbulb',
      order: 3,
      keywords: ['light', 'lamp', 'fixture', 'luminaire', 'illuminat']
    },
    'ì ‘ì§€/í”¼ë¢°': {
      icon: 'fa-solid fa-bolt',
      order: 4,
      keywords: ['ground', 'earth', 'lightning', 'surge', 'protection']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'Piping': {
    'ë°°ê´€': {
      icon: 'fa-solid fa-grip-lines',
      order: 1,
      keywords: ['pipe', 'tube', 'line', 'piping', 'fitting', 'flange', 'elbow', 'tee', 'reducer']
    },
    'ë°¸ë¸Œ': {
      icon: 'fa-solid fa-sliders',
      order: 2,
      keywords: ['valve', 'gate', 'globe', 'check', 'ball', 'butterfly', 'control']
    },
    'íŒí”„/íƒ±í¬': {
      icon: 'fa-solid fa-gas-pump',
      order: 3,
      keywords: ['pump', 'tank', 'vessel', 'reservoir']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'HVAC': {
    'ë•íŠ¸': {
      icon: 'fa-solid fa-wind',
      order: 1,
      keywords: ['duct', 'damper', 'diffuser', 'grille', 'louver', 'plenum']
    },
    'ê³µì¡°ê¸°ê¸°': {
      icon: 'fa-solid fa-fan',
      order: 2,
      keywords: ['ahu', 'fcu', 'unit', 'coil', 'fan', 'blower', 'compressor', 'chiller', 'boiler']
    },
    'ëƒ‰ë‚œë°©': {
      icon: 'fa-solid fa-temperature-half',
      order: 3,
      keywords: ['cool', 'heat', 'temperature', 'refriger', 'thermal']
    },
    'í™˜ê¸°': {
      icon: 'fa-solid fa-arrows-rotate',
      order: 4,
      keywords: ['ventilat', 'exhaust', 'supply', 'air', 'fresh', 'return']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'Fire Protection': {
    'ìŠ¤í”„ë§í´ëŸ¬': {
      icon: 'fa-solid fa-shower',
      order: 1,
      keywords: ['sprinkler', 'head', 'pipe', 'riser', 'standpipe']
    },
    'ì†Œí™”ì„¤ë¹„': {
      icon: 'fa-solid fa-fire-extinguisher',
      order: 2,
      keywords: ['extinguish', 'suppression', 'foam', 'gas', 'halon', 'co2', 'chemical']
    },
    'ê²½ë³´/ê°ì§€': {
      icon: 'fa-solid fa-bell',
      order: 3,
      keywords: ['alarm', 'detector', 'sensor', 'smoke', 'heat', 'notification']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'Instrument & Control': {
    'ê³„ê¸°': {
      icon: 'fa-solid fa-gauge',
      order: 1,
      keywords: ['gauge', 'meter', 'indicator', 'transmitter', 'sensor']
    },
    'ì œì–´': {
      icon: 'fa-solid fa-sliders',
      order: 2,
      keywords: ['control', 'plc', 'dcs', 'hmi', 'scada', 'logic']
    },
    'ë°¸ë¸Œ/ì•¡ì¶”ì—ì´í„°': {
      icon: 'fa-solid fa-cog',
      order: 3,
      keywords: ['valve', 'actuator', 'positioner', 'solenoid']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'BIM': {
    'ëª¨ë¸ë§': {
      icon: 'fa-solid fa-cube',
      order: 1,
      keywords: ['model', 'geometry', 'object', 'element', 'component', 'family', 'library']
    },
    'ì¢Œí‘œ/ê¸°ì¤€': {
      icon: 'fa-solid fa-crosshairs',
      order: 2,
      keywords: ['coordinate', 'point', 'base', 'survey', 'level', 'grid']
    },
    'í’ˆì§ˆê²€í† ': {
      icon: 'fa-solid fa-check-double',
      order: 3,
      keywords: ['clash', 'quality', 'review', 'check', 'validation']
    },
    'ë°ì´í„°/ì†ì„±': {
      icon: 'fa-solid fa-database',
      order: 4,
      keywords: ['data', 'parameter', 'property', 'attribute', 'information', 'lod']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  },
  'Cell': {
    'ë°°í„°ë¦¬': {
      icon: 'fa-solid fa-battery-full',
      order: 1,
      keywords: ['battery', 'cell', 'module', 'pack', 'bms']
    },
    'ì „ê·¹/ì†Œì¬': {
      icon: 'fa-solid fa-atom',
      order: 2,
      keywords: ['electrode', 'cathode', 'anode', 'electrolyte', 'separator', 'material']
    },
    'ì¼ë°˜': {
      icon: 'fa-solid fa-folder',
      order: 99,
      keywords: []
    }
  }
};

// ìš©ì–´ì— ì¹´í…Œê³ ë¦¬ í• ë‹¹ í•¨ìˆ˜
function assignCategory(term) {
  const discipline = term.discipline;
  const categories = categoryMap[discipline];
  if (!categories) return 'ì¼ë°˜';

  const searchText = ((term.en || '') + ' ' + (term.kr || '') + ' ' + (term.description || '')).toLowerCase();

  let bestMatch = 'ì¼ë°˜';
  let bestOrder = 999;

  for (const [catName, catInfo] of Object.entries(categories)) {
    if (catName === 'ì¼ë°˜') continue;
    for (const keyword of catInfo.keywords) {
      if (searchText.includes(keyword.toLowerCase())) {
        if (catInfo.order < bestOrder) {
          bestMatch = catName;
          bestOrder = catInfo.order;
        }
        break;
      }
    }
  }
  return bestMatch;
}

// í˜„ì¬ ì •ë ¬ ëª¨ë“œ (alphabet / relevance) - ê¸°ë³¸ê°’: relevance
let currentSortMode = 'relevance';

/* ===========================================
   3) ì´ˆê¸°í™”
   =========================================== */
async function initializeGlossary() {
  // ë¡œë”© í‘œì‹œ
  const tbody = document.getElementById('glossaryTableBody');
  if (tbody) tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px;color:#666;">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>';

  // JSON ë°ì´í„° ë¡œë“œ
  glossaryData = await loadGlossaryData();
  console.log('Loaded ' + glossaryData.length + ' terms');

  renderDisciplineShortcuts();
  setupEventListeners();
  renderTable();
}

(function safelyInit() {
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeGlossary, { once: true });
  } else {
    initializeGlossary();
  }
})();

/* ===========================================
   4) ì´ë²¤íŠ¸
   =========================================== */
function setupEventListeners() {
  const searchInput = document.getElementById('searchInput');
  if (searchInput) searchInput.addEventListener('input', handleSearch);

  const disciplineBtn = document.getElementById('disciplineViewBtn');
  const allBtn = document.getElementById('allViewBtn');
  if (disciplineBtn) disciplineBtn.addEventListener('click', () => setView('discipline'));
  if (allBtn) allBtn.addEventListener('click', () => setView('all'));

  // ì •ë ¬ ëª¨ë“œ ë²„íŠ¼
  const alphabetBtn = document.getElementById('alphabetSortBtn');
  const relevanceBtn = document.getElementById('relevanceSortBtn');
  if (alphabetBtn) alphabetBtn.addEventListener('click', () => setSortMode('alphabet'));
  if (relevanceBtn) relevanceBtn.addEventListener('click', () => setSortMode('relevance'));

  const firstBtn = document.getElementById('firstPageBtn');
  const prevBtn  = document.getElementById('prevPageBtn');
  const nextBtn  = document.getElementById('nextPageBtn');
  const lastBtn  = document.getElementById('lastPageBtn');
  if (firstBtn) firstBtn.addEventListener('click', () => goToPage(1));
  if (prevBtn)  prevBtn.addEventListener('click', () => goToPage(currentPage - 1));
  if (nextBtn)  nextBtn.addEventListener('click', () => goToPage(currentPage + 1));
  if (lastBtn)  lastBtn.addEventListener('click', () => {
    const totalPages = Math.ceil(filteredDataGlobal.length / itemsPerPage) || 1;
    goToPage(totalPages);
  });
}

function setSortMode(mode) {
  currentSortMode = mode;
  document.getElementById('alphabetSortBtn').classList.toggle('active', mode === 'alphabet');
  document.getElementById('relevanceSortBtn').classList.toggle('active', mode === 'relevance');
  currentPage = 1;
  renderTable(document.getElementById('searchInput').value || '');
}

/* ===========================================
   5) í•¸ë“¤ëŸ¬ / ë Œë”ë§
   =========================================== */
function handleSearch(e) {
  const val = (e.target.value || '').toLowerCase();
  currentPage = 1;
  renderTable(val);
}

function setView(view) {
  currentView = view;
  document.getElementById('disciplineViewBtn').classList.toggle('active', view === 'discipline');
  document.getElementById('allViewBtn').classList.toggle('active', view === 'all');
  document.getElementById('disciplineHeader').style.display = (view === 'discipline') ? 'none' : 'table-cell';
  currentPage = 1;
  renderTable(document.getElementById('searchInput').value || '');
}

function renderDisciplineShortcuts() {
  const container = document.getElementById('disciplineShortcuts');
  if (!container) return;
  container.innerHTML = '';
  disciplineOrder.forEach(discipline => {
    const info = disciplineMap[discipline] || {};
    const el = document.createElement('button');
    el.type = 'button';
    el.className = 'discipline-tag' + (discipline === selectedDiscipline ? ' active' : '');
    el.innerHTML = '<i class="' + (info.icon || 'fa-solid fa-folder') + '"></i> ' + (info.koreanName || discipline);
    el.addEventListener('click', () => {
      selectedDiscipline = discipline;
      renderDisciplineShortcuts();
      if (currentView === 'discipline') { currentPage = 1; renderTable(document.getElementById('searchInput').value || ''); }
    });
    container.appendChild(el);
  });
}

function renderTable(searchTerm = '') {
  const tbody = document.getElementById('glossaryTableBody');
  if (!tbody) return;

  let filtered = glossaryData.slice();
  if (searchTerm) {
    filtered = filtered.filter(t =>
      fuzzyMatch(searchTerm, t.en || '') ||
      fuzzyMatch(searchTerm, t.kr || '') ||
      fuzzyMatch(searchTerm, t.description || '') ||
      fuzzyMatch(searchTerm, disciplineMap[t.discipline]?.abbreviation || '') ||
      fuzzyMatch(searchTerm, disciplineMap[t.discipline]?.koreanName || '')
    );
  }
  if (currentView === 'discipline') {
    filtered = filtered.filter(t => t.discipline === selectedDiscipline);
  }

  // ëª¨ë“  ìš©ì–´ì— ì¹´í…Œê³ ë¦¬ í• ë‹¹ (Category ì—´ í‘œì‹œë¥¼ ìœ„í•´)
  filtered.forEach(t => {
    t._category = assignCategory(t);
  });

  // ì—°ê´€ì„± ì •ë ¬ ëª¨ë“œ
  if (currentSortMode === 'relevance') {
    // ì¹´í…Œê³ ë¦¬ ìˆœì„œ ë° ì•ŒíŒŒë²³ìˆœ ì •ë ¬
    filtered.sort((a, b) => {
      if (currentView === 'all') {
        const ai = disciplineOrder.indexOf(a.discipline);
        const bi = disciplineOrder.indexOf(b.discipline);
        if (ai !== bi) return ai - bi;
      }

      const catMapA = categoryMap[a.discipline] || {};
      const catMapB = categoryMap[b.discipline] || {};
      const catInfoA = catMapA[a._category] || { order: 99 };
      const catInfoB = catMapB[b._category] || { order: 99 };

      if (catInfoA.order !== catInfoB.order) {
        return catInfoA.order - catInfoB.order;
      }
      return a.en.localeCompare(b.en);
    });
  } else {
    // ì•ŒíŒŒë²³ìˆœ ì •ë ¬
    filtered.sort((a, b) => {
      if (currentView === 'discipline') return a.en.localeCompare(b.en);
      const ai = disciplineOrder.indexOf(a.discipline);
      const bi = disciplineOrder.indexOf(b.discipline);
      return ai !== bi ? ai - bi : a.en.localeCompare(b.en);
    });
  }

  filteredDataGlobal = filtered;

  const total = filtered.length;
  const totalPages = Math.ceil(total / itemsPerPage) || 1;
  if (currentPage > totalPages) currentPage = totalPages;
  const start = (currentPage - 1) * itemsPerPage;
  const end   = Math.min(start + itemsPerPage, total);
  const pageData = filtered.slice(start, end);

  updatePaginationInfo(total, start, end);
  renderPaginationControls(totalPages);

  tbody.innerHTML = '';
  if (total === 0) {
    const row = tbody.insertRow();
    const cell = row.insertCell();
    cell.colSpan = (currentView === 'discipline') ? 4 : 5;
    cell.innerHTML = '<div class="empty-state">ë“±ë¡ëœ ìš©ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    document.getElementById('paginationContainer').style.display = 'none';
    return;
  }
  document.getElementById('paginationContainer').style.display = (total > itemsPerPage) ? 'flex' : 'none';

  pageData.forEach(t => {
    const row = tbody.insertRow();

    // ì „ì²´ ë³´ê¸°ì¼ ë•Œ êµ¬ë¶„ ì—´ í‘œì‹œ
    if (currentView === 'all') {
      const dcell = row.insertCell();
      const badge = (disciplineMap[t.discipline]?.abbreviation) || t.discipline;
      dcell.innerHTML = '<span class="discipline-badge">' + badge + '</span>';
    }

    // Category ì—´ ì¶”ê°€
    const catCell = row.insertCell();
    const category = t._category || 'ì¼ë°˜';
    const catInfo = categoryMap[t.discipline]?.[category] || { icon: 'fa-solid fa-folder' };
    catCell.innerHTML = '<span class="category-cell"><i class="' + catInfo.icon + '"></i> ' + category + '</span>';
    catCell.className = 'category-col';

    const en = row.insertCell();
    en.textContent = formatEnglishTerm(t.en || '');
    en.className = 'term-en';

    const kr = row.insertCell();
    kr.textContent = t.kr || '';
    kr.className = 'term-kr';

    const desc = row.insertCell();
    desc.textContent = t.description || '';
  });
}

/* ===========================================
   6) í˜ì´ì§€ë„¤ì´ì…˜
   =========================================== */
function updatePaginationInfo(total, start, end) {
  const info = document.getElementById('paginationInfo');
  if (!info) return;
  info.textContent = total === 0 ? 'ì „ì²´ 0ê°œ ìš©ì–´' : 'ì „ì²´ ' + total + 'ê°œ ìš©ì–´ (' + (start + 1) + '-' + end + 'ë²ˆì§¸ í‘œì‹œ)';
}

function renderPaginationControls(totalPages) {
  const container = document.getElementById('paginationPages');
  const firstBtn = document.getElementById('firstPageBtn');
  const prevBtn  = document.getElementById('prevPageBtn');
  const nextBtn  = document.getElementById('nextPageBtn');
  const lastBtn  = document.getElementById('lastPageBtn');
  if (!container) return;

  container.innerHTML = '';
  firstBtn.disabled = currentPage === 1;
  prevBtn.disabled  = currentPage === 1;
  nextBtn.disabled  = currentPage === totalPages || totalPages === 0;
  lastBtn.disabled  = currentPage === totalPages || totalPages === 0;

  if (totalPages <= 1) return;

  const pages = generatePageNumbers(currentPage, totalPages);
  pages.forEach(p => {
    if (p === '...') {
      const span = document.createElement('span');
      span.className = 'pagination-ellipsis';
      span.textContent = '...';
      container.appendChild(span);
    } else {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'pagination-btn ' + (p === currentPage ? 'active' : '');
      btn.textContent = p;
      btn.addEventListener('click', () => goToPage(p));
      container.appendChild(btn);
    }
  });
}

function generatePageNumbers(current, total) {
  const pages = [];
  if (total <= 7) { for (let i = 1; i <= total; i++) pages.push(i); }
  else {
    pages.push(1);
    if (current <= 4) { for (let i = 2; i <= 5; i++) pages.push(i); pages.push('...', total); }
    else if (current >= total - 3) { pages.push('...'); for (let i = total - 4; i <= total; i++) pages.push(i); }
    else { pages.push('...', current - 1, current, current + 1, '...', total); }
  }
  return pages;
}

function goToPage(page) {
  const totalPages = Math.ceil((filteredDataGlobal.length || 0) / itemsPerPage) || 1;
  if (page < 1 || page > totalPages) return;
  currentPage = page;
  renderTable(document.getElementById('searchInput').value || '');
}
</script>
